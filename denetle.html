<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DetaylÄ± Veri Denetleyicisi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        body { background: #f8f9fa; padding: 20px; font-family: monospace; }
        .log-box { background: #000; color: #0f0; padding: 15px; border-radius: 8px; min-height: 200px; white-space: pre-wrap; font-size: 14px; }
        .highlight { color: #ffc107; font-weight: bold; }
        .found { color: #0d6efd; font-weight: bold; font-size: 1.1rem; }
        .missing { color: #dc3545; }
    </style>
</head>
<body>

<div class="container" style="max-width: 800px;">
    <h4 class="mb-3">ğŸ” VeritabanÄ± Derin Tarama (25-28 KasÄ±m)</h4>
    
    <div id="auth-ui" class="text-center my-4">
        <button class="btn btn-primary" onclick="login()">Google ile GiriÅŸ Yap ve Tara</button>
    </div>

    <div id="status-area">Durum: Bekleniyor...</div>
    
    <div class="card mb-3">
        <div class="card-header fw-bold">Hedef Tarihler (2025)</div>
        <ul class="list-group list-group-flush" id="target-dates-list">
            <!-- Buraya sonuÃ§lar gelecek -->
        </ul>
    </div>

    <label>TÃ¼m Ham Veri (Raw JSON):</label>
    <div id="console-log" class="log-box">GiriÅŸ yapÄ±lmadÄ±...</div>
</div>

<script>
    // --- FIREBASE AYARLARI ---
    const firebaseConfig = {
        apiKey: "AIzaSyC7zdr3x8H--8piHR_1muAz2TVOOaebI54",
        authDomain: "kazanamazi-ser.firebaseapp.com",
        databaseURL: "https://kazanamazi-ser-default-rtdb.firebaseio.com",
        projectId: "kazanamazi-ser",
        storageBucket: "kazanamazi-ser.firebasestorage.app",
        messagingSenderId: "951730390034",
        appId: "1:951730390034:web:639f96ee859c10b0e944cb",
        measurementId: "G-5WGCDTL1RX"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();

    const logBox = document.getElementById('console-log');
    const statusArea = document.getElementById('status-area');

    function log(msg) {
        logBox.innerText += msg + "\n";
    }

    function login() {
        auth.signInWithPopup(provider)
            .then((result) => {
                statusArea.innerHTML = "<span class='text-success'>GiriÅŸ BaÅŸarÄ±lÄ±. Veri Ã‡ekiliyor...</span>";
                const user = result.user;
                log(`KullanÄ±cÄ±: ${user.displayName} (${user.uid})`);
                log("VeritabanÄ±na baÄŸlanÄ±lÄ±yor...");
                scanDatabase(user.uid);
            })
            .catch((error) => {
                statusArea.innerHTML = "<span class='text-danger'>Hata: " + error.message + "</span>";
                log("HATA: " + error.message);
            });
    }

    function scanDatabase(uid) {
        // DoÄŸrudan logs klasÃ¶rÃ¼ne deÄŸil, bir Ã¼st klasÃ¶re (namazData) bakÄ±yoruz
        // Hatta en garanti olsun diye direkt User ID kÃ¶kÃ¼ne bakÄ±yoruz.
        const rootRef = db.ref('users/' + uid);

        rootRef.once('value')
            .then((snapshot) => {
                const val = snapshot.val();

                if (!val) {
                    log("âš ï¸ BU KULLANICI Ä°Ã‡Ä°N HÄ°Ã‡BÄ°R VERÄ° BULUNAMADI!");
                    statusArea.innerHTML = "<span class='text-danger'>VeritabanÄ± bu kullanÄ±cÄ± iÃ§in tamamen boÅŸ.</span>";
                    return;
                }

                log("âœ… Veri paketi alÄ±ndÄ±. Analiz ediliyor...");
                log("Veri YapÄ±sÄ± AnahtarlarÄ±: " + Object.keys(val).join(", "));

                // Veri yolunu bulmaya Ã§alÄ±ÅŸalÄ±m
                let logsData = null;
                if (val.namazData && val.namazData.logs) {
                    logsData = val.namazData.logs;
                    log("Kanal: users -> namazData -> logs (BULUNDU)");
                } else if (val.logs) {
                    logsData = val.logs;
                    log("Kanal: users -> logs (BULUNDU)");
                } else {
                    log("âŒ 'logs' klasÃ¶rÃ¼ bulunamadÄ±. Veriler farklÄ± bir yerde olabilir.");
                    log("Mevcut veri dÃ¶kÃ¼mÃ¼ aÅŸaÄŸÄ±dadÄ±r:");
                    log(JSON.stringify(val, null, 2));
                    return;
                }

                // HEDEF TARÄ°HLERÄ° KONTROL ET
                checkSpecificDates(logsData);

                // TÃœM VERÄ°YÄ° YAZDIR
                log("\n--- TÃœM LOG KAYITLARI (Ham Hali) ---");
                log(JSON.stringify(logsData, null, 2));

            })
            .catch((err) => {
                log("Veri okuma hatasÄ±: " + err);
            });
    }

    function checkSpecificDates(logs) {
        const targets = ["2025-11-25", "2025-11-26", "2025-11-27", "2025-11-28", "2025-11-29"];
        const list = document.getElementById('target-dates-list');
        list.innerHTML = "";

        targets.forEach(date => {
            const count = logs[date];
            let itemHtml = "";
            
            if (count !== undefined) {
                itemHtml = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="found">${date}</span>
                    <span class="badge bg-success rounded-pill fs-6">${count} Namaz</span>
                </li>`;
                log(`BULUNDU: ${date} -> ${count}`);
            } else {
                itemHtml = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="text-muted">${date}</span>
                    <span class="badge bg-danger rounded-pill">Veri Yok</span>
                </li>`;
                log(`YOK: ${date} tarihinde kayÄ±t yok.`);
            }
            list.innerHTML += itemHtml;
        });
    }
</script>

</body>
</html>