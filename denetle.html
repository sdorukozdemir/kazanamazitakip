<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veri DÃ¼zenleme Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body class="bg-light p-4">

<div class="container bg-white p-4 rounded shadow" style="max-width: 600px;">
    <h4 class="mb-4 text-primary">ğŸ› ï¸ GeÃ§miÅŸ GÃ¼nleri DÃ¼zenle</h4>
    
    <div id="auth-section" class="text-center">
        <button class="btn btn-dark" onclick="login()">Google ile GiriÅŸ Yap</button>
    </div>

    <div id="editor-section" style="display:none;">
        <div class="alert alert-warning small">
            Buradan geÃ§miÅŸ gÃ¼nlerdeki hatalÄ± veya eksik kayÄ±tlarÄ± dÃ¼zeltebilirsiniz.
            DeÄŸiÅŸiklik anÄ±nda veritabanÄ±na yansÄ±r.
        </div>

        <h5 class="mt-3">Son 7 GÃ¼n</h5>
        <div id="days-list" class="list-group">
            YÃ¼kleniyor...
        </div>
    </div>
</div>

<script>
    // FIREBASE AYARLARI
    const firebaseConfig = {
        apiKey: "AIzaSyC7zdr3x8H--8piHR_1muAz2TVOOaebI54",
        authDomain: "kazanamazi-ser.firebaseapp.com",
        databaseURL: "https://kazanamazi-ser-default-rtdb.firebaseio.com",
        projectId: "kazanamazi-ser",
        storageBucket: "kazanamazi-ser.firebasestorage.app",
        messagingSenderId: "951730390034",
        appId: "1:951730390034:web:639f96ee859c10b0e944cb",
        measurementId: "G-5WGCDTL1RX"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();
    let currentUserUid = null;

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUserUid = user.uid;
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('editor-section').style.display = 'block';
            loadLast7Days();
        }
    });

    function login() {
        auth.signInWithPopup(provider).catch(e => alert(e.message));
    }

    function getIsoDate(d) {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
    }

    function loadLast7Days() {
        const list = document.getElementById('days-list');
        list.innerHTML = "";
        
        // Son 7 gÃ¼nÃ¼ oluÅŸtur
        const dates = [];
        for(let i=0; i<7; i++) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            dates.push(getIsoDate(d));
        }

        // VeritabanÄ±ndan verileri Ã§ek
        db.ref('users/' + currentUserUid + '/namazData/logs').once('value', s => {
            const data = s.val() || {};
            
            dates.forEach(date => {
                const val = data[date] !== undefined ? data[date] : 0;
                
                const html = `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="fw-bold">${date}</span>
                    <div class="d-flex gap-2">
                        <input type="number" id="inp-${date}" class="form-control form-control-sm text-center fw-bold" style="width:70px;" value="${val}">
                        <button class="btn btn-sm btn-success" onclick="saveDate('${date}')">Kaydet</button>
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        });
    }

    window.saveDate = function(date) {
        const newVal = parseInt(document.getElementById('inp-' + date).value);
        if(isNaN(newVal)) return alert("LÃ¼tfen sayÄ± girin");

        db.ref('users/' + currentUserUid + '/namazData/logs/' + date).set(newVal)
            .then(() => {
                alert(date + " tarihi " + newVal + " olarak gÃ¼ncellendi! âœ…");
                // Efekt olsun diye yeÅŸil yakalÄ±m
                document.getElementById('inp-' + date).style.backgroundColor = "#d1e7dd";
            })
            .catch(e => alert("Hata: " + e.message));
    }
</script>

</body>
</html>
