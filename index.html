<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Kaza ve ƒ∞badet Takip</title>
    
    <meta name="theme-color" content="#198754">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" id="my-manifest">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Amiri:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>

    <style>
        /* --- TEMA AYARLARI --- */
        :root { 
            --bg-color: #e3e6ec; --text-color: #212529; --card-bg: #ffffff; --sidebar-bg: #157347; 
            --table-head: #157347; --table-row-bg: #ffffff; --input-bg: #f8f9fa; --input-text: #000000; 
            --border-color: #ced4da; --modal-bg: #ffffff;
            
            /* RENKLER */
            --col-namaz-bg: #5a826e; --col-namaz-text: #ffffff;
            --table-foot-bg: #1f3b2f; --table-foot-border: #142921;
            
            --z-btn-minus-bg: #e9ecef; --z-btn-minus-text: #495057;
            --z-btn-reset-bg: #fff3cd; --z-btn-reset-text: #856404;
            --z-btn-plus-bg: linear-gradient(145deg, #198754, #20c997);
            
            --scroll-track: #e9ecef; --scroll-thumb: #ced4da;
            --box-target-bg: #e8f5e9; --box-target-border: #c3e6cb; --box-target-text: #155724;
            --box-add-bg: #e7f1ff; --box-add-border: #b6d4fe;
            --stat-avg-color: #6610f2;
            --calc-box-bg: #f8f9fa; --calc-header-bg: linear-gradient(135deg, #198754, #20c997);
            --calc-header-text: #ffffff; --calc-header-shadow: rgba(25, 135, 84, 0.3);
            --placeholder-color: #6c757d;

            /* KADIN MODU RENKLERƒ∞ */
            --period-color: #d63384;
            --period-bg: #fce4ec;
        }
        body.dark-mode { 
            --bg-color: #121212; --text-color: #e0e0e0; --card-bg: #1e1e1e; --sidebar-bg: #0f5132; 
            --table-head: #0f5132; --table-row-bg: #2d2d2d; --input-bg: #3a3a3a; --input-text: #ffffff; 
            --border-color: #444; --modal-bg: #2d2d2d;
            
            --col-namaz-bg: #1e3b2e; --col-namaz-text: #e0e0e0;
            --table-foot-bg: #0b1a15; --table-foot-border: #050d0a;
            
            --z-btn-minus-bg: #343a40; --z-btn-minus-text: #ced4da;
            --z-btn-reset-bg: #3e2c00; --z-btn-reset-text: #ffc107;
            --z-btn-plus-bg: linear-gradient(145deg, #0f5132, #146c43);
            
            --scroll-track: #2d2d2d; --scroll-thumb: #555;
            --box-target-bg: #0f2e1c; --box-target-border: #146c43; --box-target-text: #75b798;
            --box-add-bg: #052c65; --box-add-border: #084298;
            --stat-avg-color: #d63384; 
            --calc-box-bg: #2d2d2d; --calc-header-bg: linear-gradient(135deg, #0f5132, #146c43);
            --calc-header-text: #e0e0e0; --calc-header-shadow: rgba(0, 0, 0, 0.5);
            --placeholder-color: #bbbbbb;
            
            --period-bg: #2d0b16;
        }
        
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Poppins', sans-serif; transition: 0.3s; overflow-x: hidden; min-height: 100vh; }

        /* LOADING & OVERLAYS */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease, visibility 0.5s; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(25, 135, 84, 0.2); border-top-color: #198754; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 15px; font-weight: 600; color: #198754; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* GENDER SELECTION OVERLAY */
        #gender-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 9000; display: none; justify-content: center; align-items: center; flex-direction: column; }
        .gender-card { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
        .gender-btn { width: 120px; height: 120px; border-radius: 20px; border: 2px solid var(--border-color); background: var(--input-bg); margin: 10px; cursor: pointer; transition: 0.2s; display: inline-flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; color: var(--text-color); }
        .gender-btn:hover, .gender-btn.selected { transform: scale(1.05); border-color: #198754; background: #d1e7dd; color: #0f5132; }
        .gender-btn i { font-size: 3rem; margin-bottom: 10px; }
        .gender-btn.female:hover, .gender-btn.female.selected { border-color: #d63384; background: #fce4ec; color: #a21b5b; }

        /* SIDEBAR */
        .wrapper { display: flex; width: 100%; }
        #sidebar { min-width: 260px; max-width: 260px; background: var(--sidebar-bg); color: #fff; height: 100vh; transition: 0.3s; z-index: 2000; position: fixed; top: 0; left: 0; overflow-y: auto; margin-left: -260px; }
        #overlay { display: none; position: fixed; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 1999; top: 0; left: 0; backdrop-filter: blur(2px); }
        #overlay.active { display: block; }
        #sidebar.active { margin-left: 0; }
        @media (min-width: 769px) { #sidebar { position: sticky; margin-left: 0; } #sidebar.active { margin-left: -260px; } #overlay { display: none !important; } #content { width: calc(100% - 260px); } }
        @media (max-width: 768px) { #content { width: 100%; } }
        #sidebar ul li { padding: 15px; cursor: pointer; border-left: 5px solid transparent; transition: 0.2s; }
        #sidebar ul li:hover { background: rgba(255,255,255,0.1); }
        #sidebar ul li.active { background: rgba(255,255,255,0.2); border-left-color: #fff; font-weight: 600; }
        #content { padding: 20px; min-height: 100vh; transition: 0.3s; width: 100%; max-width: 900px; margin: 0 auto; }

        /* COMPONENTS */
        .app-header { text-align: center; color: var(--sidebar-bg); font-weight: 600; margin-bottom: 25px; font-size: 1.5rem; }
        body.dark-mode .app-header { color: #20c997; }
        .card-custom { border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); padding: 20px; margin-bottom: 20px; }
        
        /* TABLE */
        .table-responsive { border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; overflow-x: auto; width: 100%; display: block; }
        .main-table { color: var(--text-color); font-size: 0.85rem; width: 100%; border-collapse: collapse; min-width: 650px; }
        .main-table th { background-color: var(--table-head); color: white; text-align: center; padding: 12px 5px; border: 1px solid var(--border-color); vertical-align: middle; }
        .main-table td { background-color: var(--table-row-bg); color: var(--text-color); border: 1px solid var(--border-color); text-align: center; padding: 10px 5px; vertical-align: middle; }
        .table-input, .table-value-box { text-align: center; font-weight: bold; background-color: var(--input-bg); color: var(--input-text); border: 1px solid var(--border-color); width: 100%; height: 38px; border-radius: 8px; margin: 0; display: flex; align-items: center; justify-content: center; }
        .col-namaz { background-color: var(--col-namaz-bg) !important; color: var(--col-namaz-text) !important; font-weight: 600; min-width: 80px; }
        
        /* ACTIONS */
        .action-wrapper { display: flex; justify-content: center; align-items: center; gap: 5px; height: 38px; }
        .btn-action { width: 38px; height: 38px; border-radius: 8px; border: none; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2); font-size: 1.2rem; display: flex; justify-content: center; align-items: center; }
        .btn-plus { background-color: #198754; } .btn-minus { background-color: #6c757d; }
        .btn-action:active { transform: scale(0.9); }

        /* MUAYYEN MODE STYLES */
        .period-active .btn-plus, .period-active .btn-minus, .period-active .table-input { filter: grayscale(100%); opacity: 0.5; pointer-events: none; }
        .period-banner { background-color: var(--period-bg); border: 2px solid var(--period-color); color: var(--period-color); padding: 10px; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; display: none; }
        .period-switch-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .form-switch .form-check-input { width: 3em; height: 1.5em; cursor: pointer; }
        .form-switch .form-check-input:checked { background-color: var(--period-color); border-color: var(--period-color); }

        /* GOAL CARD */
        .goal-card { background: linear-gradient(135deg, #198754, #20c997); color: white; padding: 20px; margin-bottom: 20px; text-align: center; border-radius: 16px; }
        .goal-card.success-mode { border: 3px solid #ffc107; }
        .goal-input { width: 70px; text-align: center; font-weight: bold; border: none; border-radius: 5px; color: #198754; background: white; }
        
        /* PROGRESS */
        .progress-container { height: 28px; display: flex; flex-direction: column; justify-content: flex-end; margin-top: 6px; }
        .progress { height: 15px; border-radius: 7px; background-color: #e9ecef; width: 100%; }
        .progress-text { font-size: 10px; margin-top: 4px; line-height: 1; font-weight: bold; }
        .spacer-box { height: 28px; margin-top: 6px; visibility: hidden; }

        /* CALCULATOR */
        .calc-row { background-color: var(--calc-box-bg); padding: 0; border-radius: 12px; margin-bottom: 25px; border: 1px solid var(--border-color); overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .calc-header { background: var(--calc-header-bg); color: var(--calc-header-text); padding: 8px 20px; text-align: center; font-weight: bold; font-size: 1.1rem; margin: 12px auto 5px auto; width: fit-content; min-width: 120px; border-radius: 20px; box-shadow: 0 4px 10px var(--calc-header-shadow); }
        .calc-body { padding: 15px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .calc-item { flex: 1; min-width: 150px; text-align: center; }
        .calc-label-small { font-size: 0.85rem; opacity: 0.8; display: block; margin-bottom: 5px; color: var(--text-color); }
        .date-input { text-align: center; background-color: var(--input-bg); color: var(--input-text); border: 1px solid var(--border-color); width: 100%; padding: 8px; border-radius: 8px; height: 45px; }
        .calc-result-input { font-weight: bold; color: #d9534f; text-align: center; font-size: 1.3rem; height: 45px; background-color: var(--input-bg); border: 2px solid var(--border-color); width: 100%; }

        /* ZIKIR & BADGES */
        .zikr-card { padding: 25px; text-align: center; border-top: 6px solid #198754; height: 100%; border-radius: 16px; background: var(--card-bg); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
        .zikr-btn-group { display: flex; gap: 15px; align-items: center; justify-content: center; margin: 20px 0; }
        .zikr-btn { border: none; display: flex; align-items: center; justify-content: center; transition: transform 0.05s; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .z-plus { width: 90px; height: 90px; border-radius: 25px; background: var(--z-btn-plus-bg); color: white; font-size: 2.5rem; }
        .z-minus, .z-reset { width: 55px; height: 55px; border-radius: 15px; font-size: 1.2rem; }
        .z-minus { background: var(--z-btn-minus-bg); color: var(--z-btn-minus-text); }
        .z-reset { background: var(--z-btn-reset-bg); color: var(--z-btn-reset-text); }
        .badge-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px auto; }
        .badge-item { width: 110px; padding: 10px; background: var(--card-bg); border-radius: 15px; border: 1px solid var(--border-color); text-align: center; }
        .badge-item.locked { filter: grayscale(100%); opacity: 0.5; }

        /* MODAL */
        .custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .custom-modal { background: var(--modal-bg); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-btn { padding: 10px 25px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer; }
        .modal-btn-group { display: flex; justify-content: center; gap: 25px; margin-top: 15px; }
        .btn-confirm { background: #dc3545; color: white; } .btn-cancel { background: #6c757d; color: white; } .btn-ok { background: #198754; color: white; width: 100%; }

        /* BOTTOM NAV */
        .bottom-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background: var(--card-bg); border-top: 1px solid var(--border-color); z-index: 1060; justify-content: space-around; align-items: center; padding-bottom: 10px; }
        .nav-item { text-align: center; color: var(--text-color); opacity: 0.6; font-size: 0.75rem; flex: 1; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: #198754; opacity: 1; font-weight: 600; }
        @media (max-width: 768px) { .bottom-nav { display: flex; } #content { padding-bottom: 90px; } }
    </style>
</head>
<body>

<!-- LOADING -->
<div id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Veriler Y√ºkleniyor...</div>
</div>

<!-- GENDER SELECTION OVERLAY -->
<div id="gender-overlay">
    <div class="gender-card">
        <h3>Ho≈ü Geldiniz</h3>
        <p class="text-muted">Ki≈üiselle≈ütirilmi≈ü bir deneyim i√ßin l√ºtfen cinsiyetinizi se√ßiniz.</p>
        <div class="d-flex justify-content-center">
            <div class="gender-btn" onclick="selectGender('male')">
                <i class="fas fa-male"></i>
                Erkek
            </div>
            <div class="gender-btn female" onclick="selectGender('female')">
                <i class="fas fa-female"></i>
                Kadƒ±n
            </div>
        </div>
        <p class="small mt-3 text-muted">Bu se√ßim hesaplamalar ve √∂zel modlar i√ßin kullanƒ±lƒ±r.</p>
    </div>
</div>

<!-- MODAL -->
<div id="customModal" class="custom-modal-overlay">
    <div class="custom-modal">
        <h4 id="modalTitle">Ba≈ülƒ±k</h4>
        <p id="modalMessage">Mesaj.</p>
        <div class="modal-btn-group" id="modalButtons"></div>
    </div>
</div>
<div id="overlay" onclick="toggleSidebar()"></div>

<!-- LOGIN -->
<div id="login-screen" style="height: 100vh; display: flex; justify-content: center; align-items: center;">
    <div class="card-custom p-5 text-center" style="max-width: 400px;">
        <h3 class="text-success fw-bold mb-4">ƒ∞badet Takip</h3>
        <button class="btn btn-dark w-100 py-3 rounded-pill" onclick="loginWithGoogle()">
            <i class="fab fa-google me-2"></i> Google ile Giri≈ü
        </button>
    </div>
</div>

<!-- MAIN APP -->
<div id="app-wrapper" class="wrapper" style="display:none;">
    <nav id="sidebar">
        <div class="p-4 text-center" style="background: rgba(0,0,0,0.1);">
            <h4 class="fw-bold"><i class="fas fa-kaaba me-2"></i>Takip</h4>
            <small id="sidebarUserInfo" class="text-white-50">...</small>
        </div>
        <ul class="list-unstyled components p-2">
            <li id="menu-dashboard" class="active" onclick="showSection('dashboard')"><i class="fas fa-mosque me-3"></i> Kaza Namazƒ±</li>
            <li id="menu-stats" onclick="showSection('stats')"><i class="fas fa-chart-pie me-3"></i> ƒ∞statistikler</li>
            <li id="menu-tesbihat" onclick="showSection('tesbihat')"><i class="fas fa-fingerprint me-3"></i> Tesbihat</li>
            <li id="menu-calculator" onclick="showSection('calculator')"><i class="fas fa-calculator me-3"></i> Hesap Sihirbazƒ±</li>
            <li id="menu-settings" onclick="showSection('settings')"><i class="fas fa-cog me-3"></i> Ayarlar</li>
            <li onclick="toggleDarkMode()"><i class="fas fa-moon me-3"></i> <span id="darkModeText">Gece Modu</span></li>
            <li onclick="logout()"><i class="fas fa-sign-out-alt me-3"></i> √áƒ±kƒ±≈ü Yap</li>
        </ul>
    </nav>

    <div id="content">
        <!-- DASHBOARD -->
        <div id="section-dashboard" style="display: block;">
            
            <!-- PERIOD BANNER & SWITCH (Visible only for Female) -->
            <div id="periodControlArea" style="display: none;">
                <div class="period-banner" id="periodBanner">
                    <div><i class="fas fa-heart me-2"></i> <strong>Muayyen G√ºn Modu Aktif</strong></div>
                    <div class="small">Hedefler ve Zincir etkilenmez.</div>
                </div>
                <div class="d-flex justify-content-center align-items-center mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="periodSwitch" onchange="togglePeriodMode(this.checked)">
                        <label class="form-check-label fw-bold" for="periodSwitch" style="color:var(--period-color)">Muayyen G√ºn√ºmdeyim (ƒ∞badet Molasƒ±)</label>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center mb-4">
                <div class="col-md-8 col-lg-6">
                    <div id="goalCard" class="goal-card">
                        <h4>üéØ G√ºnl√ºk Hedef</h4>
                        <div class="goal-content d-flex justify-content-center align-items-center gap-2 mt-3">
                            <span class="fs-5">Bug√ºn</span>
                            <strong class="fs-1" id="dailyCountDisplay">0</strong>
                            <span class="fs-5">/</span>
                            <input type="number" id="dailyGoalInput" class="goal-input" value="10" onchange="updateDailyGoal(this.value)">
                            <span class="fs-5">Kaza</span>
                        </div>
                        <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.3); border-radius: 10px;">
                            <div id="dailyProgressBar" class="progress-bar bg-warning" style="width: 0%"></div>
                        </div>
                        <div id="goalSuccessMessage" class="mt-2 fw-bold text-white" style="display: none;">üéâ Harika! Hedefe Ula≈üƒ±ldƒ±!</div>
                        <div class="mt-2" style="background: rgba(255, 255, 255, 0.2); padding: 5px 15px; border-radius: 20px; display: inline-flex; align-items: center; gap: 8px;">
                            <i class="fas fa-fire text-warning"></i> <span>Zincir:</span>
                            <span id="streakValue" class="fw-bold text-warning">0</span> <span>G√ºn</span>
                        </div>
                    </div>
                    
                    <!-- HAFTALIK MEYDAN OKUMA -->
                    <div id="weeklyCard" class="goal-card" style="background: linear-gradient(135deg, #0d6efd, #0dcaf0); margin-top: 20px;">
                        <h4>üèÜ Haftalƒ±k Meydan Okuma</h4>
                        <div class="goal-content d-flex justify-content-center align-items-center gap-2 mt-3">
                            <span class="fs-5">Bu Hafta</span>
                            <strong class="fs-1" id="weeklyCountDisplay">0</strong>
                            <span class="fs-5">/</span>
                            <input type="number" id="weeklyGoalInput" class="goal-input" style="color:#0d6efd;" value="50" onchange="updateWeeklyGoal(this.value)">
                        </div>
                        <div class="progress mt-2" style="height: 10px; background: rgba(255,255,255,0.3); border-radius: 10px;">
                            <div id="weeklyProgressBar" class="progress-bar bg-warning" style="width: 0%"></div>
                        </div>
                        <div id="weeklySuccessMessage" class="mt-2 fw-bold text-white" style="display: none;">üî• Bu Hafta Tamamlandƒ±!</div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-center gap-3 mb-4 flex-wrap align-items-center">
                <div><label class="fw-bold text-secondary small">BA≈ûLAMA TARƒ∞Hƒ∞</label> 
                    <input type="text" id="startDate" class="form-control text-center" placeholder="gg.aa.yyyy" onfocus="(this.type='date')" onblur="(this.type='text')">
                </div>
                <div><label class="fw-bold text-secondary small">GE√áEN S√úRE (G√úN)</label> <input type="text" id="elapsedDays" class="form-control text-center fw-bold" readonly></div>
            </div>

            <div class="table-responsive mb-4" id="prayerTableContainer">
                <table class="table main-table">
                    <thead>
                        <tr>
                            <th>Namaz</th>
                            <th>Kƒ±lƒ±nacak</th>
                            <th>Kƒ±lƒ±nan</th>
                            <th class="col-action">ƒ∞≈ülem</th>
                            <th>Ortalama</th>
                            <th>Tahmini Biti≈ü</th>
                        </tr>
                    </thead>
                    <tbody id="prayerTableBody"></tbody>
                    <tfoot id="prayerTableFoot"></tfoot>
                </table>
            </div>

            <!-- TAHMƒ∞Nƒ∞ Bƒ∞Tƒ∞≈û KARTI -->
            <div class="row mt-4 justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="card-custom h-100 text-center">
                        <i class="fas fa-hourglass-half text-success fs-1 mb-2"></i>
                        <h5 class="fw-bold">Ne Zaman Biter?</h5>
                        <div id="prediction-container" class="mt-3">
                            <div class="fs-4 fw-bold text-success" id="estFinishDate">Hesaplanƒ±yor...</div>
                            <div class="text-muted fw-bold" id="estDaysLeft">...</div>
                            <small class="text-uppercase text-muted mt-2 d-block">G√ºnl√ºk Hedefe G√∂re</small>
                        </div>
                        <div id="prediction-success" class="text-success fw-bold mt-2" style="display:none;">üéâ Borcunuz bulunmamaktadƒ±r!</div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4"><h5 class="fw-bold text-secondary">Rozet M√ºzesi</h5></div>
            <div id="badgeContainer" class="badge-container"></div>
        </div>

        <!-- ƒ∞STATƒ∞STƒ∞KLER -->
        <div id="section-stats" style="display: none;">
            <h3 class="app-header">ƒ∞statistikler</h3>
            <div class="row g-4">
                <div class="col-md-12">
                    <div class="card-custom text-center">
                        <h5 class="mb-3 fw-bold">Genel Durum</h5>
                        <canvas id="completionChart" style="max-height: 250px;"></canvas>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="card-custom text-center">
                        <h5 class="mb-3 fw-bold">Namaz Bazlƒ± Daƒüƒ±lƒ±m</h5>
                        <canvas id="barChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TESBƒ∞HAT -->
        <div id="section-tesbihat" style="display: none;">
            <h3 class="app-header">Tesbihat ve Zikir</h3>
            <div class="row g-4" id="tesbihatContainer"></div>
        </div>

        <!-- HESAPLAMA Sƒ∞Hƒ∞RBAZI -->
        <div id="section-calculator" style="display: none;">
            <h3 class="app-header">Kaza Hesaplama Sihirbazƒ±</h3>
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card-custom">
                        <div class="alert alert-info small mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            Sorumluluk (Buluƒü) ve D√ºzenli Ba≈ülama tarihlerini giriniz.
                        </div>
                        
                        <!-- KADIN KULLANICILAR ƒ∞√áƒ∞N EK ALAN -->
                        <div id="femaleCalcArea" class="mb-4 p-3 rounded" style="background-color: var(--period-bg); border: 1px solid var(--period-color); display:none;">
                             <label class="fw-bold" style="color: var(--period-color)">Ortalama Adet (Muayyen) G√ºn√º (Ayda)</label>
                             <input type="number" id="avgPeriodDays" class="form-control text-center fw-bold mt-2" value="7" onchange="renderCalculatorRows()">
                             <small class="d-block mt-1 text-muted">Bu g√ºn sayƒ±sƒ±, her ay i√ßin toplam bor√ßtan otomatik d√º≈ü√ºlecektir.</small>
                        </div>

                        <div class="d-flex justify-content-end gap-2 mb-3">
                            <button class="btn btn-sm btn-outline-info" onclick="copyStartDate()">Ba≈ülangƒ±cƒ± Kopyala</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="copyEndDate()">Biti≈üi Kopyala</button>
                        </div>
                        <div id="calcRowsContainer"></div>
                        <hr class="my-4">
                        <button class="btn btn-danger w-100 py-3 rounded-pill fw-bold" onclick="applyAdvancedCalculation()">
                            <i class="fas fa-check-circle me-2"></i> Hesaplananlarƒ± Kaydet
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AYARLAR -->
        <div id="section-settings" style="display: none;">
            <h3 class="app-header">Ayarlar</h3>
            <div class="row justify-content-center g-4">
                <div class="col-md-6">
                    <div class="card-custom text-center">
                        <h5>Veri Y√∂netimi</h5>
                        <button class="btn btn-success w-100 mb-2" onclick="downloadBackupJSON()">Yedek ƒ∞ndir (.json)</button>
                        <button class="btn btn-primary w-100 mb-2" onclick="document.getElementById('importFile').click()">Yedek Y√ºkle</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackupJSON(this)">
                        <button class="btn btn-danger w-100" onclick="confirmResetData()">Verileri Sƒ±fƒ±rla</button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card-custom text-center">
                        <h5>Profil</h5>
                         <p class="text-muted">Se√ßili Cinsiyet: <strong id="settingsGenderDisp">-</strong></p>
                         <button class="btn btn-outline-secondary btn-sm" onclick="resetGender()">Cinsiyeti Deƒüi≈ütir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('dashboard'); activateNav(this)"><i class="fas fa-mosque"></i><span>Kaza</span></div>
    <div class="nav-item" onclick="showSection('stats'); activateNav(this)"><i class="fas fa-chart-pie"></i><span>ƒ∞statistik</span></div>
    <div class="nav-item" onclick="showSection('tesbihat'); activateNav(this)"><i class="fas fa-fingerprint"></i><span>Tesbihat</span></div>
    <div class="nav-item" onclick="showSection('calculator'); activateNav(this)"><i class="fas fa-calculator"></i><span>Hesap</span></div>
    <div class="nav-item" onclick="toggleSidebar()"><i class="fas fa-bars"></i><span>Men√º</span></div>
</div>

<script>
    const jsConfetti = new JSConfetti();
    
    // --- FIREBASE YAPILANDIRMASI ---
    const firebaseConfig = {
        apiKey: "AIzaSyC7zdr3x8H--8piHR_1muAz2TVOOaebI54",
        authDomain: "kazanamazi-ser.firebaseapp.com",
        databaseURL: "https://kazanamazi-ser-default-rtdb.firebaseio.com",
        projectId: "kazanamazi-ser",
        storageBucket: "kazanamazi-ser.firebasestorage.app",
        messagingSenderId: "951730390034",
        appId: "1:951730390034:web:639f96ee859c10b0e944cb"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();
    let dbRef = null;

    // --- VARSAYILAN VERƒ∞ ---
    const defaultData = {
        gender: null, // 'male' or 'female'
        startDate: new Date().toISOString().split('T')[0],
        isOnPeriod: false, // Kadƒ±nlar i√ßin muayyen modu
        daily: { date: "", counts: [0,0,0,0,0], target: 10 },
        weeklyTarget: 50,
        streak: { current: 0, lastAchievedDate: "" },
        calendar: {}, // Kaza yapƒ±lan g√ºnler { "2023-11-28": true }
        periodLogs: {}, // Muayyen g√ºnler { "2023-11-28": true }
        logs: {}, // Detaylƒ± loglar (g√ºnl√ºk toplam sayƒ±)
        counts: [{name:"Sabah",target:0,done:0},{name:"√ñƒüle",target:0,done:0},{name:"ƒ∞kindi",target:0,done:0},{name:"Ak≈üam",target:0,done:0},{name:"Yatsƒ±",target:0,done:0}],
        tesbihat: [
            { name: "S√ºbhanallah", arabic: "ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸê", current: 0, target: 33 },
            { name: "Elhamd√ºlillah", arabic: "Ÿ±ŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸ∞ŸáŸê", current: 0, target: 33 },
            { name: "Allahu Ekber", arabic: "Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸè ÿ£ŸéŸÉŸíÿ®Ÿéÿ±Ÿè", current: 0, target: 33 }
        ],
        earnedBadges: [], history: []
    };
    let localData = JSON.parse(JSON.stringify(defaultData));
    let chartCompletion = null;
    let barChart = null;

    // --- Gƒ∞Rƒ∞≈û & VERƒ∞ Y√úKLEME ---
    auth.onAuthStateChanged((user) => {
        if (user) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'flex';
            document.getElementById('sidebarUserInfo').innerText = user.displayName;
            
            dbRef = db.ref('users/' + user.uid + '/namazData');
            dbRef.on('value', (s) => {
                const d = s.val();
                if (d) localData = d;
                
                // Veri Yapƒ±sƒ± Kontrol√º
                if (!localData.counts) localData.counts = defaultData.counts;
                if (!localData.daily) localData.daily = { date: getIsoDate(new Date()), counts: [0,0,0,0,0], target: 10 };
                if (localData.weeklyTarget === undefined) localData.weeklyTarget = 50;
                if (!localData.periodLogs) localData.periodLogs = {};
                
                checkDailyReset();
                
                // Cinsiyet Kontrol√º
                if (!localData.gender) {
                    document.getElementById('gender-overlay').style.display = 'flex';
                } else {
                    document.getElementById('gender-overlay').style.display = 'none';
                    applyGenderSettings();
                }

                // Muayyen Modu Kontrol√º
                if (localData.isOnPeriod) {
                    // Eƒüer bug√ºn muayyen moddaysa, bug√ºn√º loglara i≈üle (zincir korumasƒ± i√ßin)
                    const today = getIsoDate(new Date());
                    if (!localData.periodLogs[today]) {
                        localData.periodLogs[today] = true;
                        saveToCloud();
                    }
                }

                renderApp();
                renderCalculatorRows(); // Hesaplamayƒ± g√ºncelle
                hideLoader();
            });
        } else {
            hideLoader();
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app-wrapper').style.display = 'none';
        }
    });

    function loginWithGoogle() { auth.signInWithPopup(provider).catch(e => showModal("Hata", e.message)); }
    function logout() { auth.signOut(); }
    function saveToCloud() { if(dbRef) dbRef.set(localData); }

    // --- Cƒ∞NSƒ∞YET & MUAYYEN AYARLARI ---
    function selectGender(g) {
        localData.gender = g;
        saveToCloud();
        document.getElementById('gender-overlay').style.display = 'none';
        applyGenderSettings();
    }

    function applyGenderSettings() {
        const isFemale = localData.gender === 'female';
        
        // Dashboard'da Muayyen butonu g√∂ster/gizle
        document.getElementById('periodControlArea').style.display = isFemale ? 'block' : 'none';
        
        // Hesap makinesinde kadƒ±n √∂zel alanƒ±
        document.getElementById('femaleCalcArea').style.display = isFemale ? 'block' : 'none';
        
        // Ayarlar kƒ±smƒ±nda g√∂ster
        document.getElementById('settingsGenderDisp').innerText = isFemale ? "Kadƒ±n" : "Erkek";

        // Switch durumunu g√ºncelle
        document.getElementById('periodSwitch').checked = localData.isOnPeriod || false;
        
        applyPeriodVisuals();
    }

    function togglePeriodMode(isActive) {
        localData.isOnPeriod = isActive;
        
        if (isActive) {
            const today = getIsoDate(new Date());
            localData.periodLogs[today] = true; // Bug√ºn√º muayyen olarak i≈üaretle
            jsConfetti.addConfetti({ emojis: ['üå∏', 'üíñ'], confettiNumber: 30 });
            showModal("Muayyen Modu", "ƒ∞badet takibi duraklatƒ±ldƒ±. Zinciriniz bozulmayacak.");
        }
        
        saveToCloud();
        applyPeriodVisuals();
    }

    function applyPeriodVisuals() {
        const tableContainer = document.getElementById('prayerTableContainer');
        const banner = document.getElementById('periodBanner');
        
        if (localData.isOnPeriod) {
            tableContainer.classList.add('period-active'); // Butonlarƒ± pasifle≈ütir
            banner.style.display = 'flex';
        } else {
            tableContainer.classList.remove('period-active');
            banner.style.display = 'none';
        }
        // Zinciri yeniden hesapla (g√∂rsel g√ºncelleme i√ßin)
        recalculateStreak(); 
    }

    function resetGender() {
        localData.gender = null;
        saveToCloud();
        document.getElementById('gender-overlay').style.display = 'flex';
    }

    // --- ANA ƒ∞≈ûLEMLER ---
    function renderApp() {
        document.getElementById('startDate').value = localData.startDate;
        
        // G√ºnl√ºk Hesap
        const dailyTotal = localData.daily.counts.reduce((a,b)=>a+b,0);
        document.getElementById('dailyCountDisplay').innerText = dailyTotal;
        document.getElementById('dailyGoalInput').value = localData.daily.target;
        
        let dp = (dailyTotal / localData.daily.target) * 100; if(dp>100) dp=100;
        document.getElementById('dailyProgressBar').style.width = dp + "%";
        
        // Haftalƒ±k Hesap
        const weeklyTotal = getWeeklyProgress();
        document.getElementById('weeklyCountDisplay').innerText = weeklyTotal;
        document.getElementById('weeklyGoalInput').value = localData.weeklyTarget;
        let wp = (weeklyTotal / localData.weeklyTarget) * 100; if(wp>100) wp=100;
        document.getElementById('weeklyProgressBar').style.width = wp + "%";

        // Tablo Olu≈üturma
        const tbody = document.getElementById('prayerTableBody');
        const tfoot = document.getElementById('prayerTableFoot');
        tbody.innerHTML = "";
        let totalTarget=0, totalDone=0, totalRem=0;
        const days = getElapsedDays(); 
        document.getElementById('elapsedDays').value = days;

        localData.counts.forEach((item, i) => {
            totalTarget += parseInt(item.target); 
            totalDone += parseInt(item.done);
            const rem = Math.max(0, item.target - item.done); 
            totalRem += rem;
            
            const avg = (item.done / days).toFixed(2);
            const estText = formatTime(avg > 0 ? Math.ceil(rem/avg) : 0);
            
            tbody.innerHTML += `<tr>
                <td class="col-namaz">${item.name}</td>
                <td><input type="number" class="table-input" value="${item.target}" onchange="upT(${i},this.value)"></td>
                <td><input type="number" class="table-input" value="${item.done}" onchange="upD(${i},this.value)"></td>
                <td class="col-action">
                    <div class="action-wrapper">
                        <button class="btn-action btn-plus" onclick="chC(${i},1)">+</button>
                        <button class="btn-action btn-minus" onclick="chC(${i},-1)">-</button>
                    </div>
                </td>
                <td><div class="table-value-box">${avg}</div></td>
                <td><div class="table-value-box">${estText}</div></td>
            </tr>`;
        });
        
        const overallAvg = (totalDone/days).toFixed(2);
        tfoot.innerHTML = `<tr><td>Toplam</td><td>${totalTarget}</td><td>${totalDone}</td><td></td><td>${overallAvg}</td><td>-</td></tr>`;

        recalculateStreak();
        document.getElementById('streakValue').innerText = localData.streak.current;
        
        calculateEstFinish(totalDone, days, totalRem);
        renderBadges(totalDone);
        applyPeriodVisuals(); // Tablonun pasiflik durumunu kontrol et
    }

    // --- Zƒ∞NCƒ∞R MANTIƒûI (G√úNCELLENDƒ∞) ---
    function recalculateStreak() {
        let streak = 0;
        const today = new Date();
        
        // Bug√ºn i≈ülem yapƒ±ldƒ± mƒ± VEYA bug√ºn muayyen g√ºn m√º?
        const isoToday = getIsoDate(today);
        if ((localData.calendar && localData.calendar[isoToday]) || (localData.periodLogs && localData.periodLogs[isoToday])) {
            streak++;
        }

        // Ge√ßmi≈üe doƒüru kontrol
        for (let i = 1; i < 2000; i++) {
            const d = new Date();
            d.setDate(today.getDate() - i);
            const iso = getIsoDate(d);
            
            const hasPrayer = localData.calendar && localData.calendar[iso];
            const isPeriod = localData.periodLogs && localData.periodLogs[iso];

            if (hasPrayer || isPeriod) {
                streak++;
            } else {
                // Eƒüer d√∂ng√ºdeki ilk g√ºnse (d√ºn) ve bug√ºn hen√ºz i≈ülem yapƒ±lmadƒ±ysa zinciri kƒ±rma
                if (i === 1 && streak === 0) {
                    // D√ºn bo≈ü ge√ßmi≈üse zincir 0 kalƒ±r, devam etme
                    break; 
                } else if (i === 1 && streak > 0) {
                   // Bug√ºn var, d√ºn yok -> Zincir bug√ºn ba≈üladƒ± (1)
                   break;
                } else {
                    break;
                }
            }
        }
        localData.streak.current = streak;
    }

    // --- ƒ∞≈ûLEM FONKSƒ∞YONLARI ---
    window.upT = function(i, v) { localData.counts[i].target = parseInt(v) || 0; saveToCloud(); renderApp(); };
    window.upD = function(i, v) { localData.counts[i].done = parseInt(v) || 0; saveToCloud(); renderApp(); };
    
    window.chC = function(i, d) {
        if(localData.isOnPeriod) return; // Muayyen modda i≈ülem engelle

        const old = localData.counts[i].done;
        const n = old + d;
        if (n >= 0) {
            localData.counts[i].done = n;
            if (d > 0) {
                localData.daily.counts[i]++;
                const todayISO = getIsoDate(new Date());
                
                // Log Ekleme
                if(!localData.logs) localData.logs = {};
                localData.logs[todayISO] = (localData.logs[todayISO] || 0) + 1;

                // Hedef Kontrol√º
                const ct = localData.daily.counts.reduce((a,b)=>a+b,0);
                if (ct >= localData.daily.target) {
                    localData.calendar[todayISO] = true;
                    if(ct === localData.daily.target) jsConfetti.addConfetti();
                }
            } else if (localData.daily.counts[i] > 0) {
                localData.daily.counts[i]--;
                // Log azaltma (basit tutuyoruz)
            }
            saveToCloud(); renderApp();
        }
    };

    window.updateDailyGoal = function(v) { localData.daily.target = parseInt(v)||10; saveToCloud(); renderApp(); };
    window.updateWeeklyGoal = function(v) { localData.weeklyTarget = parseInt(v)||50; saveToCloud(); renderApp(); };

    // --- HESAPLAMA Sƒ∞Hƒ∞RBAZI (G√úNCELLENDƒ∞) ---
    window.renderCalculatorRows = function() { 
        const c = document.getElementById('calcRowsContainer'); 
        if(!c) return;
        c.innerHTML = ""; 
        const types = ["Sabah", "√ñƒüle", "ƒ∞kindi", "Ak≈üam", "Yatsƒ±"];
        
        types.forEach((p, i) => {
            c.innerHTML += `
            <div class="calc-row" id="row-${i}">
                <div class="calc-header">${p}</div>
                <div class="calc-body">
                    <div class="calc-item"><small class="calc-label-small">Sorumluluk Ba≈ülangƒ±cƒ±</small><input type="date" class="date-input" onchange="calcRow(${i})"></div>
                    <div class="calc-item"><small class="calc-label-small">D√ºzenli Ba≈ülama</small><input type="date" class="date-input" onchange="calcRow(${i})"></div>
                    <div class="calc-item"><small class="calc-label-small">Sonu√ß (G√ºn)</small><input type="number" class="calc-result-input" id="res-${i}" value="0"></div>
                </div>
            </div>`;
        });
    };

    window.calcRow = function(i) {
        const row = document.getElementById(`row-${i}`);
        const inputs = row.querySelectorAll('input');
        const d1 = new Date(inputs[0].value);
        const d2 = new Date(inputs[1].value);
        
        if (d1 && d2 && !isNaN(d1) && !isNaN(d2)) {
            const diffTime = Math.abs(d2 - d1);
            let totalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Kadƒ±n kullanƒ±cƒ±lar i√ßin adet indirimi
            if (localData.gender === 'female') {
                const avgPeriod = parseInt(document.getElementById('avgPeriodDays').value) || 0;
                if (avgPeriod > 0) {
                    // Toplam ay sayƒ±sƒ±nƒ± bul
                    const totalMonths = totalDays / 30;
                    // D√º≈ü√ºlecek g√ºn sayƒ±sƒ±
                    const deduction = Math.floor(totalMonths * avgPeriod);
                    totalDays = Math.max(0, totalDays - deduction);
                }
            }
            document.getElementById(`res-${i}`).value = totalDays;
        }
    };
    
    window.copyStartDate = function() { const v = document.querySelector('#row-0 input[type="date"]').value; for(let i=1;i<5;i++){ document.querySelectorAll(`#row-${i} input[type="date"]`)[0].value = v; calcRow(i); }};
    window.copyEndDate = function() { const v = document.querySelectorAll('#row-0 input[type="date"]')[1].value; for(let i=1;i<5;i++){ document.querySelectorAll(`#row-${i} input[type="date"]`)[1].value = v; calcRow(i); }};
    window.applyAdvancedCalculation = function() { 
        showModal("Onay", "Hesaplanan deƒüerler mevcut hedeflerin √ºzerine yazƒ±lsƒ±n mƒ±?", () => {
            for(let i=0;i<5;i++) {
                localData.counts[i].target = parseInt(document.getElementById(`res-${i}`).value) || 0;
            }
            saveToCloud(); showSection('dashboard');
        });
    };

    // --- YARDIMCI FONKSƒ∞YONLAR ---
    function getIsoDate(d) { return d.toISOString().split('T')[0]; }
    function checkDailyReset() {
        const t = getIsoDate(new Date());
        if (localData.daily.date !== t) {
            localData.daily.date = t;
            localData.daily.counts = [0,0,0,0,0];
            
            // Eƒüer hala muayyen modundaysa bug√ºn√º de logla
            if(localData.isOnPeriod) localData.periodLogs[t] = true;
            
            saveToCloud();
        }
    }
    function getWeeklyProgress() {
        if(!localData.logs) return 0;
        const d = new Date();
        const day = d.getDay();
        const diff = d.getDate() - day + (day == 0 ? -6 : 1); 
        const monday = new Date(d.setDate(diff)); monday.setHours(0,0,0,0);
        let t = 0;
        Object.keys(localData.logs).forEach(k => { if(new Date(k) >= monday) t += localData.logs[k]; });
        return t;
    }
    function getElapsedDays() { 
        if(!localData.startDate) return 1;
        const s = new Date(localData.startDate); const n = new Date();
        return Math.ceil(Math.abs(n-s)/(86400000)) || 1;
    }
    function formatTime(d) { if(d<=0) return "Tamamlandƒ±"; const y=Math.floor(d/365); const r=d%365; const m=Math.floor(r/30); const fd=Math.floor(r%30); return `${y>0?y+' Yƒ±l ':''}${m>0?m+' Ay ':''}${fd} G.`; }
    function calculateEstFinish(done, days, debt) {
        if (debt <= 0) {
            document.getElementById('prediction-container').style.display='none';
            document.getElementById('prediction-success').style.display='block';
            return;
        }
        document.getElementById('prediction-container').style.display='block';
        document.getElementById('prediction-success').style.display='none';
        
        const target = localData.daily.target || 10;
        const daysLeft = Math.ceil(debt / target);
        const fDate = new Date(); fDate.setDate(fDate.getDate() + daysLeft);
        document.getElementById('estFinishDate').innerText = fDate.toLocaleDateString('tr-TR', {year:'numeric',month:'long',day:'numeric'});
        document.getElementById('estDaysLeft').innerText = `${daysLeft} G√ºn Kaldƒ±`;
    }

    // --- NAVBAR & UI ---
    window.showSection = function(id) {
        document.querySelectorAll('.wrapper > div > div[id^="section-"]').forEach(d => d.style.display='none');
        document.getElementById('section-'+id).style.display='block';
        document.querySelectorAll('#sidebar li').forEach(l => l.classList.remove('active'));
        const m = document.getElementById('menu-'+id); if(m) m.classList.add('active');
        if(window.innerWidth < 768) { document.getElementById('sidebar').classList.remove('active'); document.getElementById('overlay').classList.remove('active'); }
        if(id === 'stats') renderStats();
        if(id === 'tesbihat') renderTesbihat();
    };
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
    function activateNav(el) { document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active')); el.classList.add('active'); }
    function hideLoader() { document.getElementById('loading-overlay').style.display = 'none'; }
    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    
    // --- MODAL ---
    function showModal(t, m, c) {
        document.getElementById('modalTitle').innerText = t;
        document.getElementById('modalMessage').innerText = m;
        const b = document.getElementById('modalButtons'); b.innerHTML = "";
        if(c) {
            b.innerHTML = `<button class="modal-btn btn-cancel" onclick="closeModal()">ƒ∞ptal</button><button class="modal-btn btn-confirm" id="mConf">Onayla</button>`;
            document.getElementById('mConf').onclick = () => { c(); closeModal(); };
        } else { b.innerHTML = `<button class="modal-btn btn-ok" onclick="closeModal()">Tamam</button>`; }
        document.getElementById('customModal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('customModal').style.display = 'none'; }

    // --- OTHER ---
    function renderBadges(total) { /* Basit badge render */ }
    function renderStats() { /* Chart.js kodlarƒ± buraya */ }
    function renderTesbihat() { /* Tesbihat kodlarƒ± */ }
    function downloadBackupJSON() { /* Yedek */ }
    
    // Manifest
    const pwaIcon = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%23198754' d='M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256 256-114.6 256-256S401.4 0 256 0zm-46.8 389L68.6 248.4c-4.7-4.7-4.7-12.3 0-17l28.3-28.3c4.7-4.7 12.3-4.7 17 0L209.2 298l188.8-188.8c4.7-4.7 12.3-4.7 17 0l28.3 28.3c4.7 4.7 4.7 12.3 0 17L226.2 389c-4.7 4.7-12.3 4.7-17 0z'/%3E%3C/svg%3E";
    const manifestBlob = new Blob([JSON.stringify({ "name": "ƒ∞badet Takip", "display": "standalone", "theme_color": "#198754", "icons": [{ "src": pwaIcon, "sizes": "192x192", "type": "image/svg+xml" }] })], {type: 'application/json'});
    document.querySelector('#my-manifest').href = URL.createObjectURL(manifestBlob);

</script>
</body>
</html>
